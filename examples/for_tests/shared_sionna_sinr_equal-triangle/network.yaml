# MANET Shared Bridge with SINR/Interference (Co-channel)
#
# This example demonstrates:
# - 3-node MANET with shared broadcast domain (Linux bridge)
# - SINR computation with co-channel interference
# - All nodes on same frequency (5.18 GHz) for actual communication
#
# Assumptions:
# - SINR computation is implemented with co-channel interference
# - Per-destination netem via tc filters
#
# Topology:
#   node1 (5.18 GHz) --- node2 (5.18 GHz) --- node3 (5.18 GHz)
#   30m equilateral triangle in free space
#
# Expected SINR:
# - Co-channel interference (0 dB ACLR)
# - Equilateral triangle → signal = interference
# - SINR ≈ 0 dB (worst-case scenario)
# - Not suitable for connectivity testing with any modulation
# - Use for validating SINR computation correctness only
# - For connectivity tests, see: shared_sionna_sinr_asymmetric/

name: manet-triangle-shared-sinr

topology:
  enable_sinr: true  # Enable SINR computation with interference from all nodes
  # SINR is computed via shared bridge all-to-all links
  # MAC model (csma/tdma) optional - provides tx_probability weighting

  scene:
    file: scenes/vacuum.xml

  shared_bridge:
    enabled: true
    name: manet-sinr-br0
    nodes: [node1, node2, node3]
    interface_name: eth1

  nodes:
    # Node 1: WiFi 6 at 5.18 GHz (Channel 36)
    node1:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.1/24
          wireless:
            position:
              x: 0
              y: 0
              z: 1
            frequency_ghz: 5.18          # Channel 36
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0    # WiFi 6 receiver sensitivity

            # Antenna configuration
            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            # Modulation (fixed for Phase 2)
            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

    # Node 2: WiFi 6 at 5.18 GHz (co-channel with node1)
    node2:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.2/24
          wireless:
            position:
              x: 30
              y: 0
              z: 1
            frequency_ghz: 5.18          # Co-channel with node1
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0

            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

    # Node 3: WiFi 6 at 5.18 GHz (co-channel with node1/node2)
    node3:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.3/24
          wireless:
            position:
              x: 15
              y: 25.98
              z: 1
            frequency_ghz: 5.18          # Co-channel with node1/node2
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0

            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

# Expected Behavior:
#
# SINR Calculation (Co-channel):
# - All nodes on same frequency (5.18 GHz)
# - Each link computes SINR accounting for co-channel interference
# - No ACLR rejection (0 dB ACLR for co-channel)
# - Worst-case scenario: all interferers transmit continuously (tx_probability=1.0)
#
# Link node1→node2:
#   - Signal: 30m, path loss ~72 dB, power = -52 dBm
#   - Interference from node3: 30m, path loss ~72 dB, power = -52 dBm
#   - SNR: 36.0 dB
#   - SINR: 0 dB (signal = interference, equilateral triangle)
#   - Packet loss: 100% (any modulation fails at SINR = 0 dB)
#
# Link node1→node3:
#   - Signal: 30m, path loss ~72 dB, power = -52 dBm
#   - Interference from node2: 30m, path loss ~72 dB, power = -52 dBm
#   - SINR: 0 dB
#   - Packet loss: 100%
#
# Link node2→node3:
#   - Signal: 30m, path loss ~72 dB, power = -52 dBm
#   - Interference from node1: 30m, path loss ~72 dB, power = -52 dBm
#   - SINR: 0 dB
#   - Packet loss: 100%
#
# Deployment:
#   sudo $(which uv) run sine deploy examples/for_tests/shared_sionna_sinr_triangle/network.yaml
#
# Expected output:
#   Link: node1→node2 [wireless, SINR enabled]
#     SNR: 36.0 dB | SINR: 0.0 dB | Interferers: 1 (node3, co-channel)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 100.0% | Rate: 0-10 Mbps
#
#   Link: node2→node1 [wireless, SINR enabled]
#     SNR: 36.0 dB | SINR: 0.0 dB | Interferers: 1 (node3, co-channel)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 100.0% | Rate: 0-10 Mbps
#
#   Link: node1→node3 [wireless, SINR enabled]
#     SNR: 36.0 dB | SINR: 0.0 dB | Interferers: 1 (node2, co-channel)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 100.0% | Rate: 0-10 Mbps
#
# Validation:
#   - SINR << SNR (SINR = 0 dB vs SNR = 36 dB, extreme degradation)
#   - All links have identical SINR = 0 dB (symmetric equilateral geometry)
#   - Connectivity: NO PACKETS DELIVERED (100% loss)
#   - Throughput: Near zero (SINR too low for any modulation)
#   - This topology demonstrates worst-case co-channel interference
#   - For working connectivity, use: shared_sionna_sinr_asymmetric/
