# MANET Shared Bridge with SINR/Interference (Phase 2)
#
# This example demonstrates:
# - 3-node MANET with shared broadcast domain (Linux bridge)
# - SINR computation with adjacent-channel interference (ACLR)
# - Mixed frequency assignment for testing ACLR rejection
#
# Assumptions:
# - Phase 2 of PLAN_SINR.md is implemented (adjacent-channel interference)
# - IEEE 802.11ax ACLR model (0, 28, 40, 45 dB)
# - Per-destination netem via tc filters
#
# Topology:
#   node1 (5.18 GHz) --- node2 (5.20 GHz) --- node3 (5.26 GHz)
#   30m equilateral triangle in free space
#
# Expected SINR:
# - node1↔node2: Adjacent channel (20 MHz separation) → 28 dB ACLR rejection
# - node1↔node3: 2nd adjacent (80 MHz separation) → 40 dB ACLR rejection
# - node2↔node3: 2nd adjacent (60 MHz separation) → 40 dB ACLR rejection

name: manet-triangle-shared-sinr

topology:
  enable_sinr: true  # Enable SINR computation with interference from all nodes
  # SINR is computed via shared bridge all-to-all links
  # MAC model (csma/tdma) optional - provides tx_probability weighting

  scene:
    file: scenes/vacuum.xml

  shared_bridge:
    enabled: true
    name: manet-sinr-br0
    nodes: [node1, node2, node3]
    interface_name: eth1

  nodes:
    # Node 1: WiFi 6 at 5.18 GHz (Channel 36)
    node1:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.1/24
          wireless:
            position:
              x: 0
              y: 0
              z: 1
            frequency_ghz: 5.18          # Channel 36
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0    # WiFi 6 receiver sensitivity

            # Antenna configuration
            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            # Modulation (fixed for Phase 2)
            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

    # Node 2: WiFi 6 at 5.20 GHz (adjacent channel, +20 MHz)
    node2:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.2/24
          wireless:
            position:
              x: 30
              y: 0
              z: 1
            frequency_ghz: 5.20          # Channel 40 (adjacent to node1)
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0

            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

    # Node 3: WiFi 6 at 5.26 GHz (2nd adjacent channel, +80 MHz from node1)
    node3:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils iperf3
      interfaces:
        eth1:
          ip_address: 192.168.100.3/24
          wireless:
            position:
              x: 15
              y: 25.98
              z: 1
            frequency_ghz: 5.26          # Channel 52 (2nd adjacent from node1)
            bandwidth_mhz: 80
            rf_power_dbm: 20.0
            rx_sensitivity_dbm: -80.0

            antenna_pattern: hw_dipole  # Half-wave dipole (2.16 dBi)
            polarization: V

            modulation: 64qam
            fec_type: ldpc
            fec_code_rate: 0.5

# Expected Behavior:
#
# SINR Calculation (Phase 2):
# - Each link computes SINR accounting for adjacent-channel interference
# - ACLR rejection per IEEE 802.11ax-2021:
#   - 0-10 MHz: 0 dB (co-channel)
#   - 10-30 MHz: 28 dB (1st adjacent)
#   - 30-50 MHz: 40 dB (2nd adjacent)
#   - >50 MHz: 45 dB (orthogonal)
#
# Link node1↔node2 (20 MHz separation):
#   - Signal: Strong (30m free space, ~35 dB SNR)
#   - Interference from node3: Reduced by 28 dB (1st adjacent ACLR)
#   - Expected SINR: ~32-33 dB (slightly below SNR due to weak interference)
#
# Link node1↔node3 (80 MHz separation):
#   - Signal: Strong (30m free space, ~35 dB SNR)
#   - Interference from node2: Reduced by 40 dB (2nd adjacent ACLR)
#   - Expected SINR: ~34.5 dB (nearly equal to SNR, interference negligible)
#
# Link node2↔node3 (60 MHz separation):
#   - Signal: Strong (30m free space, ~35 dB SNR)
#   - Interference from node1: Reduced by 40 dB (2nd adjacent ACLR)
#   - Expected SINR: ~34.5 dB
#
# Deployment:
#   sudo $(which uv) run sine deploy examples/manet_triangle_shared_sinr/network.yaml
#
# Expected output:
#   Link: node1→node2 [wireless, SINR enabled]
#     SNR: 35.2 dB | SINR: 32.8 dB | Interferers: 1 (node3, -28 dB ACLR)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 0.00% | Rate: 192 Mbps
#
#   Link: node2→node1 [wireless, SINR enabled]
#     SNR: 35.2 dB | SINR: 32.8 dB | Interferers: 1 (node3, -28 dB ACLR)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 0.00% | Rate: 192 Mbps
#
#   Link: node1→node3 [wireless, SINR enabled]
#     SNR: 35.2 dB | SINR: 34.5 dB | Interferers: 1 (node2, -40 dB ACLR)
#     Delay: 0.10 ms | Jitter: 0.00 ms | Loss: 0.00% | Rate: 192 Mbps
#
# Validation:
#   - SINR < SNR (interference present)
#   - Adjacent channel SINR degradation: ~2-3 dB (28 dB ACLR)
#   - 2nd adjacent SINR degradation: <1 dB (40 dB ACLR)
#   - Throughput: ~182-192 Mbps per link (similar to no-SINR case due to high SINR)
