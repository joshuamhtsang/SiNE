# MANET Triangle Example for SiNE
#
# This example demonstrates a 3-node Mobile Ad-hoc Network (MANET) topology
# using SiNE's point-to-point link model. Each node has direct wireless links
# to both other nodes, forming a fully-connected triangle mesh.
#
# Topology (with explicit interface assignments):
#
#           node1 (0,0,1)
#            /  \
#         eth1  eth2
#          /      \
#       eth1      eth1
#        /          \
#     node2 -------- node3
#   (10,0,1)  eth2   (5,8.66,1)
#
# Node positions form an equilateral triangle with 10m sides.
# Each node has 2 wireless interfaces connecting to the other 2 nodes.
#
# Interface assignment format:
#   endpoints: [node1:eth1, node2:eth1]  # Explicit interfaces
#   endpoints: [node1, node2]            # Auto-assigned (eth1, eth2, ...)
#
# Usage:
#   # Terminal 1: Start channel server
#   uv run sine channel-server
#
#   # Terminal 2: Deploy emulation (requires sudo for netem)
#   sudo $(which uv) run sine deploy examples/manet_triangle/network.yaml
#
#   # Terminal 3: Verify netem configuration
#   ./CLAUDE_RESOURCES/check_netem.sh
#
# Testing connectivity:
#   # Configure IP addresses on each node
#   docker exec -it clab-manet-triangle-node1 ip addr add 192.168.1.1/24 dev eth1
#   docker exec -it clab-manet-triangle-node1 ip addr add 192.168.2.1/24 dev eth2
#   docker exec -it clab-manet-triangle-node2 ip addr add 192.168.1.2/24 dev eth1
#   docker exec -it clab-manet-triangle-node2 ip addr add 192.168.3.1/24 dev eth2
#   docker exec -it clab-manet-triangle-node3 ip addr add 192.168.2.2/24 dev eth1
#   docker exec -it clab-manet-triangle-node3 ip addr add 192.168.3.2/24 dev eth2
#
#   # Ping from node1 to node2 (via eth1)
#   docker exec -it clab-manet-triangle-node1 ping -c 3 192.168.1.2
#
#   # Ping from node1 to node3 (via eth2)
#   docker exec -it clab-manet-triangle-node1 ping -c 3 192.168.2.2
#
# Note: This is a point-to-point model where each link has independent
# netem configuration. For true broadcast semantics (shared medium),
# see CLAUDE.md for the shared bridge approach.

name: manet-triangle

topology:
  scene:
    file: scenes/vacuum.xml

  channel_server: http://localhost:8000
  mobility_poll_ms: 100

  nodes:
    node1:
      kind: linux
      image: alpine:latest
      cmd: sleep infinity
      wireless:
        position:
          x: 0.0
          y: 0.0
          z: 1.0
        frequency_ghz: 5.18
        bandwidth_mhz: 80
        rf_power_dbm: 20.0
        antenna_gain_dbi: 2.0
        antenna_pattern: iso
        polarization: V
        modulation: 64qam
        fec_type: ldpc
        fec_code_rate: 0.75

    node2:
      kind: linux
      image: alpine:latest
      cmd: sleep infinity
      wireless:
        position:
          x: 10.0
          y: 0.0
          z: 1.0
        frequency_ghz: 5.18
        bandwidth_mhz: 80
        rf_power_dbm: 20.0
        antenna_gain_dbi: 2.0
        antenna_pattern: iso
        polarization: V
        modulation: 64qam
        fec_type: ldpc
        fec_code_rate: 0.75

    node3:
      kind: linux
      image: alpine:latest
      cmd: sleep infinity
      wireless:
        position:
          # Position at apex of equilateral triangle (5, 8.66, 1)
          # 8.66 = 10 * sin(60) = 10 * sqrt(3)/2
          x: 5.0
          y: 8.66
          z: 1.0
        frequency_ghz: 5.18
        bandwidth_mhz: 80
        rf_power_dbm: 20.0
        antenna_gain_dbi: 2.0
        antenna_pattern: iso
        polarization: V
        modulation: 64qam
        fec_type: ldpc
        fec_code_rate: 0.75

  # Full mesh: each node connects to both other nodes
  # This creates a point-to-point topology where each link is independent
  # Using explicit interface assignment (node:interface format)
  wireless_links:
    - endpoints: [node1:eth1, node2:eth1]  # distance: 10m
    - endpoints: [node1:eth2, node3:eth1]  # distance: 10m
    - endpoints: [node2:eth2, node3:eth2]  # distance: 10m
